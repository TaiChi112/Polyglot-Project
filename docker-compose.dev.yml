# docker-compose.dev.yml
services:
  # ==========================================
  # üêç Python FastAPI (Hot Reload)
  # ==========================================
  backend-fastapi:
    build:
      context: ./backend-fastapi
      target: builder # üö® ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏Ñ‡πà Stage 'builder'
    volumes:
      - ./backend-fastapi:/app
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "4002", "--reload"]

  # ==========================================
  # ü¶ä TypeScript Elysia (Hot Reload)
  # ==========================================
  backend-elysia:
    volumes:
      - ./backend-elysia:/app
      - /app/node_modules
    command: ["sh", "-c", "bun install && bunx prisma generate && bun run --hot src/index.ts"]

  # ==========================================
  # ‚öõÔ∏è Next.js Frontend (Hot Reload)
  # ==========================================
  frontend-nextjs:
    build:
      context: ./frontend-nextjs
      target: builder
    volumes:
      - ./frontend-nextjs:/app
      - /app/.next
    environment:
      - HOST=0.0.0.0
      - HOSTNAME=0.0.0.0
      - PORT=3000
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
    command: ["sh", "-c", "bun install && bun run dev"]

  # ==========================================
  # üêπ Go Fiber (Live Reload ‡∏î‡πâ‡∏ß‡∏¢ Air)
  # ==========================================
  backend-fiber:
    build:
      context: ./backend-fiber
      target: builder    # üö® ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏Ñ‡πà Stage 'builder' (‡∏°‡∏µ Go ‡πÅ‡∏•‡∏∞ sh)
    volumes:
      - ./backend-fiber:/app
    working_dir: /app
    command: ["sh", "-c", "go install github.com/air-verse/air@latest && air"]

  # ==========================================
  # ü¶Ä Rust Actix (Live Reload ‡∏î‡πâ‡∏ß‡∏¢ Cargo Watch)
  # ==========================================
  backend-actix:
    build:
      context: ./backend-actix
      target: builder    # üö® ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏Ñ‡πà Stage 'builder' (‡∏°‡∏µ Rust ‡πÅ‡∏•‡∏∞ sh)
    volumes:
      - ./backend-actix:/app
    working_dir: /app
    command: ["sh", "-c", "apk add --no-cache musl-dev && cargo install cargo-watch && cargo watch -x run"]